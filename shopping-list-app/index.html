<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .section {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #ddd;
      }
      input,
      button {
        margin: 5px;
        padding: 8px;
      }
      pre {
        background: #f4f4f4;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <h1>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –°–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫</h1>

    <div class="section" style="background-color: #f0f8ff">
      <h2>üìã –¢–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h2>

      <div style="margin-bottom: 15px">
        <button onclick="loadShoppingList()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        <button onclick="togglePurchased()">
          <span id="toggleText">–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–∫—É–ø–ª–µ–Ω–Ω–æ–µ</span>
        </button>
        <select id="categorySelect" onchange="filterByCategory()">
          <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
          <option value="–ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã">–ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</option>
          <option value="–•–ª–µ–±–æ–±—É–ª–æ—á–Ω—ã–µ –∏–∑–¥–µ–ª–∏—è">–•–ª–µ–±–æ–±—É–ª–æ—á–Ω—ã–µ –∏–∑–¥–µ–ª–∏—è</option>
          <option value="–û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã">–û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã</option>
          <option value="–ë–∞–∫–∞–ª–µ—è">–ë–∞–∫–∞–ª–µ—è</option>
          <option value="–ù–∞–ø–∏—Ç–∫–∏">–ù–∞–ø–∏—Ç–∫–∏</option>
        </select>
      </div>

      <table
        id="shoppingListTable"
        style="width: 100%; border-collapse: collapse"
      >
        <thead>
          <tr style="background-color: #e6f3ff">
            <th
              style="
                padding: 10px;
                text-align: left;
                border-bottom: 2px solid #ccc;
              "
            >
              –ù–∞–∑–≤–∞–Ω–∏–µ
            </th>
            <th
              style="
                padding: 10px;
                text-align: left;
                border-bottom: 2px solid #ccc;
              "
            >
              –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
            </th>
            <th
              style="
                padding: 10px;
                text-align: left;
                border-bottom: 2px solid #ccc;
              "
            >
              –ö–∞—Ç–µ–≥–æ—Ä–∏—è
            </th>
            <th
              style="
                padding: 10px;
                text-align: left;
                border-bottom: 2px solid #ccc;
              "
            >
              –°—Ç–∞—Ç—É—Å
            </th>
            <th
              style="
                padding: 10px;
                text-align: left;
                border-bottom: 2px solid #ccc;
              "
            >
              –î–µ–π—Å—Ç–≤–∏—è
            </th>
          </tr>
        </thead>
        <tbody id="shoppingListBody">
          <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
          <tr>
            <td colspan="5" style="text-align: center; padding: 20px">
              –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞...
            </td>
          </tr>
        </tbody>
      </table>

      <div id="listStats" style="margin-top: 15px; font-weight: bold"></div>
    </div>
    <div class="section">
      <h2>1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã</h2>
      <button onclick="getAllItems()">GET /api/items</button>
      <button onclick="getItemsByCategory()">
        GET —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      </button>
      <input id="categoryFilter" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" />
    </div>

    <div class="section">
      <h2>2. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID</h2>
      <input id="itemId" placeholder="ID —Ç–æ–≤–∞—Ä–∞" />
      <button onclick="getItemById()">GET /api/items/:id</button>
    </div>

    <div class="section">
      <h2>3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h2>
      <input id="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" />
      <input id="itemQuantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" type="number" />
      <input id="itemCategory" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" />
      <button onclick="createItem()">POST /api/items</button>
    </div>

    <div class="section">
      <h2>4. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
      <input id="updateId" placeholder="ID –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è" />
      <input id="updateName" placeholder="–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" />
      <button onclick="updateItem()">PUT /api/items/:id</button>
    </div>

    <div class="section">
      <h2>5. –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
      <input id="deleteId" placeholder="ID –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è" />
      <button onclick="deleteItem()">DELETE /api/items/:id</button>
    </div>

    <h2>–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:</h2>
    <pre id="response"></pre>

    <script>
      const responseEl = document.getElementById("response");

      async function fetchAndLog(url, options = {}) {
        try {
          const response = await fetch(url, options);
          const data = await response.json();
          responseEl.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
          responseEl.textContent = "–û—à–∏–±–∫–∞: " + error.message;
        }
      }

      function getAllItems() {
        fetchAndLog("/api/items");
      }

      function getItemsByCategory() {
        const category = document.getElementById("categoryFilter").value;
        const url = category ? `/api/items?category=${category}` : "/api/items";
        fetchAndLog(url);
      }

      function getItemById() {
        const id = document.getElementById("itemId").value;
        if (id) fetchAndLog(`/api/items/${id}`);
      }

      function createItem() {
        const item = {
          name: document.getElementById("itemName").value,
          quantity:
            parseInt(document.getElementById("itemQuantity").value) || 1,
          category: document.getElementById("itemCategory").value,
        };

        fetchAndLog("/api/items", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(item),
        });
      }

      function updateItem() {
        const id = document.getElementById("updateId").value;
        const name = document.getElementById("updateName").value;

        if (id && name) {
          fetchAndLog(`/api/items/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name }),
          });
        }
      }

      function deleteItem() {
        const id = document.getElementById("deleteId").value;
        if (id) {
          fetchAndLog(`/api/items/${id}`, {
            method: "DELETE",
          });
        }
      }
      // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫
      let showOnlyUnpurchased = false;
      let currentItems = [];

      async function loadShoppingList() {
        try {
          const response = await fetch("/api/items");
          currentItems = await response.json();
          renderShoppingList(currentItems);
          updateStats();
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞:", error);
        }
      }

      function renderShoppingList(items) {
        const tbody = document.getElementById("shoppingListBody");
        tbody.innerHTML = "";

        if (items.length === 0) {
          tbody.innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 20px; color: #666;">
                    –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä!
                </td>
            </tr>
        `;
          return;
        }

        // –§–∏–ª—å—Ç—Ä—É–µ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–∫—É–ø–ª–µ–Ω–Ω–æ–µ
        const filteredItems = showOnlyUnpurchased
          ? items.filter((item) => !item.purchased)
          : items;

        filteredItems.forEach((item) => {
          const row = document.createElement("tr");
          row.style.borderBottom = "1px solid #eee";
          row.style.backgroundColor = item.purchased ? "#f0f0f0" : "white";

          row.innerHTML = `
            <td style="padding: 10px; ${
              item.purchased
                ? "text-decoration: line-through; color: #888;"
                : ""
            }">
                ${item.name}
            </td>
            <td style="padding: 10px;">${item.quantity}</td>
            <td style="padding: 10px;">
                <span style="background-color: #e6f3ff; padding: 3px 8px; border-radius: 12px; font-size: 12px;">
                    ${item.category}
                </span>
            </td>
            <td style="padding: 10px;">
                <span style="color: ${
                  item.purchased ? "green" : "orange"
                }; font-weight: bold;">
                    ${item.purchased ? "‚úÖ –ö—É–ø–ª–µ–Ω–æ" : "üõí –ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å"}
                </span>
            </td>
            <td style="padding: 10px;">
                <button onclick="togglePurchase(${
                  item.id
                })" style="margin-right: 5px; padding: 5px 10px; font-size: 12px;">
                    ${
                      item.purchased
                        ? "–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω—É–∂–Ω–æ–µ"
                        : "–û—Ç–º–µ—Ç–∏—Ç—å –∫—É–ø–ª–µ–Ω–Ω—ã–º"
                    }
                </button>
                <button onclick="deleteItemFromList(${
                  item.id
                })" style="padding: 5px 10px; font-size: 12px; background-color: #ffcccc;">
                    –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;

          tbody.appendChild(row);
        });
      }

      function togglePurchase(itemId) {
        fetch(`/api/items/${itemId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            purchased: !currentItems.find((item) => item.id === itemId)
              .purchased,
          }),
        })
          .then(() => {
            loadShoppingList(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
            showNotification("–°—Ç–∞—Ç—É—Å —Ç–æ–≤–∞—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω!");
          })
          .catch((error) => console.error("–û—à–∏–±–∫–∞:", error));
      }

      async function deleteItemFromList(itemId) {
        if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞?")) return;

        try {
          await fetch(`/api/items/${itemId}`, { method: "DELETE" });
          loadShoppingList(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
          showNotification("–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ —Å–ø–∏—Å–∫–∞!");
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞:", error);
        }
      }

      function togglePurchased() {
        showOnlyUnpurchased = !showOnlyUnpurchased;
        document.getElementById("toggleText").textContent = showOnlyUnpurchased
          ? "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã"
          : "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–∫—É–ø–ª–µ–Ω–Ω–æ–µ";
        renderShoppingList(currentItems);
      }

      function filterByCategory() {
        const category = document.getElementById("categorySelect").value;
        if (!category) {
          renderShoppingList(currentItems);
          return;
        }

        const filtered = currentItems.filter(
          (item) => item.category === category
        );
        renderShoppingList(filtered);
      }

      function updateStats() {
        const total = currentItems.length;
        const purchased = currentItems.filter((item) => item.purchased).length;
        const statsEl = document.getElementById("listStats");

        statsEl.innerHTML = `
        –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ${total} | 
        –ö—É–ø–ª–µ–Ω–æ: ${purchased} | 
        –û—Å—Ç–∞–ª–æ—Å—å –∫—É–ø–∏—Ç—å: ${total - purchased}
    `;
      }

      function showNotification(message) {
        const notification = document.createElement("div");
        notification.textContent = message;
        notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #4CAF50;
        color: white;
        padding: 15px;
        border-radius: 5px;
        z-index: 1000;
        animation: fadein 0.5s, fadeout 0.5s 2.5s;
    `;

        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
      }

      document.addEventListener("DOMContentLoaded", loadShoppingList);
    </script>
  </body>
</html>
